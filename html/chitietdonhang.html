<!DOCTYPE html>
<html ng-app="myApp">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thông Tin Đơn Hàng</title>
    <link rel="shortcut icon" type="image/png" href="../assets/images/logos/runflex.jpg" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="../assets/css/styles.min.css" />
    <link rel="stylesheet" href="../assets/css/main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <!-- Tải jsPDF từ CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Tải jsPDF Autotable từ CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.6/jspdf.plugin.autotable.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/plugins/roboto/Roboto.js"></script>


    <script src="../assets/js/chitietdonhang.js"></script>
    <script src="../assets/js/main.js"></script>

    <style>
        button.btn-sm {
            font-size: 0.875rem;
            /* Giảm kích thước chữ */
            border-radius: 4px;
            /* Tạo góc bo nhỏ hơn */
        }

        .step-icon {
            font-size: 36px;
            /* Tăng kích thước icon */
        }

        .step p {
            font-size: 16px;
            /* Tăng kích thước chữ */
        }

        .line {
            height: 3px;
            /* Tăng độ dày của đường nối */
            width: 50px;
            /* Đặt chiều dài của đường nối */
            background-color: #ccc;
            /* Màu đường nối */
            margin-top: 15px;
        }

        .line-done {
            background-color: #28a745;
            /* Màu đường nối đã hoàn thành */
        }
    </style>
</head>

<body ng-controller="chiTietDonHangController">
    <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
        data-sidebar-position="fixed" data-header-position="fixed">
        <!-- Sidebar -->
        <div ng-include="'../Layout/Sidebar.html'"></div>

        <!-- Body Wrapper -->
        <div class="body-wrapper">
            <div ng-include="'../Layout/Header.html'"></div>

            <!-- Main Content -->
            <div class="container-fluid">
                <!-- Order Status Steps -->
                <div class="container mt-5">
                    <h4>Trạng Thái Đơn Hàng</h4>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="d-flex justify-content-between align-items-center">
                                <!-- Step 1: Tạo đơn hàng -->
                                <div class="step text-center" ng-if="invoice.status >= 0">
                                    <span class="step-icon" ng-class="{'step-done': invoice.status >= 0}">
                                        <iconify-icon icon="mdi:clipboard-edit-outline" width="36"
                                            height="36"></iconify-icon>
                                    </span>
                                    <p>Tạo đơn hàng</p>
                                    <small>{{ invoice.ngayTao | date: 'HH:mm:ss dd/MM/yyyy' }}</small>
                                </div>

                                <div class="line" ng-class="{'line-done': invoice.status >= 1}"></div>

                                <!-- Step 2: Chờ Xác Nhận -->
                                <div class="step text-center" ng-if="invoice.status >= 1">
                                    <span class="step-icon" ng-class="{'step-done': invoice.status >= 1}">
                                        <iconify-icon icon="mdi:timer-sand" width="36" height="36"></iconify-icon>
                                    </span>
                                    <p>Chờ Xác Nhận</p>
                                    <small>{{ invoice.ngayChoXacNhan | date: 'HH:mm:ss dd/MM/yyyy' }}</small>
                                </div>

                                <div class="line" ng-class="{'line-done': invoice.status >= 2}"></div>

                                <!-- Step 3: Chờ giao -->
                                <div class="step text-center" ng-if="invoice.status >= 2">
                                    <span class="step-icon" ng-class="{'step-done': invoice.status >= 2}">
                                        <iconify-icon icon="mdi:truck-fast" width="36" height="36"></iconify-icon>
                                    </span>
                                    <p>Chờ giao</p>
                                    <small>{{ invoice.ngayChoGiao | date: 'HH:mm:ss dd/MM/yyyy' }}</small>
                                </div>

                                <div class="line" ng-class="{'line-done': invoice.status >= 3}"></div>

                                <!-- Step 4: Đang giao -->
                                <div class="step text-center" ng-if="invoice.status >= 3">
                                    <span class="step-icon" ng-class="{'step-done': invoice.status >= 3}">
                                        <iconify-icon icon="mdi:truck" width="36" height="36"></iconify-icon>
                                    </span>
                                    <p>Đang giao</p>
                                    <small>{{ invoice.ngayDangGiao | date: 'HH:mm:ss dd/MM/yyyy' }}</small>
                                </div>

                                <div class="line" ng-class="{'line-done': invoice.status >= 4}"></div>

                                <!-- Step 5: Hoàn thành -->
                                <div class="step text-center" ng-if="invoice.status >= 4">
                                    <span class="step-icon" ng-class="{'step-done': invoice.status >= 4}">
                                        <iconify-icon icon="mdi:check-circle-outline" width="36"
                                            height="36"></iconify-icon>
                                    </span>
                                    <p>Hoàn thành</p>
                                    <small>{{ invoice.ngayHoanThanh | date: 'HH:mm:ss dd/MM/yyyy' }}</small>
                                </div>

                                <div class="line" ng-class="{'line-done': invoice.status >= 5}"></div>

                                <!-- Step 6: Hủy -->
                                <div class="step text-center" ng-if="invoice.status >= 5">
                                    <span class="step-icon" ng-class="{'step-done': invoice.status >= 5}">
                                        <iconify-icon icon="mdi:cancel" width="36" height="36"></iconify-icon>
                                    </span>
                                    <p>Hủy</p>
                                    <small>{{ invoice.ngayHuy | date: 'HH:mm:ss dd/MM/yyyy' }}</small>
                                </div>

                                <div class="line" ng-class="{'line-done': invoice.status >= 6}"></div>

                                <!-- Step 7: Chờ thanh toán -->
                                <div class="step text-center" ng-if="invoice.status >= 6">
                                    <span class="step-icon" ng-class="{'step-done': invoice.status >= 6}">
                                        <iconify-icon icon="mdi:credit-card-outline" width="36"
                                            height="36"></iconify-icon>
                                    </span>
                                    <p>Chờ thanh toán</p>
                                    <small>{{ invoice.ngayThanhToan | date: 'HH:mm:ss dd/MM/yyyy' }}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>




            <div class="container mt-4">
                <h4 class="mb-4">Chuyển Trạng Thái Đơn Hàng</h4>
                <div class="card p-4 shadow-sm">
                    <p><strong>Trạng Thái Hiện Tại:</strong> {{ getStatus(invoice.status) }}</p>

                    <!-- Bố trí 2 nút cùng 1 hàng, mỗi nút có màu sắc khác nhau và thêm biểu tượng -->
                    <div class="d-flex gap-2">

                        <button class="btn btn-success btn-sm px-4 py-2" ng-click="updateStatus(invoice)"
                            ng-disabled="invoice.status >= 4">
                            <!-- Thêm icon từ Iconify, sử dụng đúng mã -->
                            <iconify-icon icon="twemoji:pencil" width="16" height="16"
                                style="vertical-align: middle; margin-right: 5px;"></iconify-icon> Chuyển trạng thái
                        </button>
                        <!-- Kiểm tra trạng thái là "Chờ xác nhận" (Trạng thái 1) -->
                        <div ng-if="invoice.status === 1">
                            <button class="btn btn-primary btn-sm px-4 py-2" ng-click="printInvoice()">
                                <!-- Thêm icon từ Iconify -->
                                <iconify-icon icon="twemoji:printer" width="16" height="16"
                                    style="vertical-align: middle; margin-right: 5px;"></iconify-icon> In hóa đơn
                            </button>
                        </div>
                    </div>
                </div>
            </div>








            <!-- Back Button -->
            <div class="col-md-4 d-flex align-items-center">
                <a class="btn btn-secondary mt-3" ng-href="donhang.html">Quay Lại</a>
            </div>

            <!-- Invoice Details -->
            <div class="container mt-4">
                <h4 class="mb-4">Thông Tin Đơn Hàng</h4>
                <div ng-if="invoice" class="card p-4 shadow-sm">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <p><strong>Trạng Thái:</strong> <span>{{ getStatus(invoice.status) }}</span></p>
                        </div>
                        <div class="col-md-4 mb-3">
                            <p><strong>Tiền Phải Trả (Sau khi cộng trừ phí khoản khác):</strong>
                                <span>{{ calculateAmountToPay(invoicedetail) | currency }}</span>
                            </p>
                        </div>

                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <p><strong>Mã Hóa Đơn:</strong> <span>{{ invoice.invoiceCode }}</span></p>
                        </div>
                        <div class="col-md-4 mb-3">
                            <p><strong>Ngày Đặt Hàng:</strong> <span>{{ invoice.createdDate | date: 'dd/MM/yyyy'
                                    }}</span></p>
                        </div>
                    </div>
                </div>

                <div ng-if="!invoice">
                    <p class="text-danger">Không tìm thấy thông tin đơn hàng!</p>
                </div>
            </div>

            <div class="container mt-4">
                <h4 class="mb-4">Thông Tin Khách Hàng</h4>
                <div ng-if="invoice" class="card p-4 shadow-sm">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <p><strong>Tên Người Nhận:</strong> <span>{{ invoice.consigneeName }}</span></p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <p><strong>Địa chỉ:</strong> <span>{{ invoice.deliveryAddress }}</span></p>
                        </div>
                        <div class="col-md-4 mb-3">
                            <p><strong>Số Điện Thoại:</strong> <span>{{ invoice.phoneNumber }}</span></p>
                        </div>
                    </div>
                </div>
                <div ng-if="!invoice">
                    <p class="text-danger">Không tìm thấy thông tin đơn hàng!</p>
                </div>
            </div>

            <h4 class="mb-4">Lịch Sử Thanh Toán</h4>
            <div class="table-responsive mt-4">
                <table class="table table-bordered table-hover table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>#</th>
                            <th>Số tiền</th>
                            <th>Thời gian</th>
                            <th>Phương thức thanh toán</th>
                            <th>Nhân viên xác nhận</th>
                            <th>Ghi chú</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Nội dung bảng sẽ được chèn vào đây -->
                    </tbody>
                </table>
            </div>

            <!-- Nút Xác nhận thanh toán -->
            <div class="d-flex justify-content-end mt-3">
                <button class="btn btn-success">Xác nhận thanh toán</button>
            </div>


            <h4 class="mb-4">Thông Tin Sản Phẩm</h4>
            <div class="table-responsive mt-4">
                <table class="table table-bordered table-hover table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>#</th>
                            <th>Tên Sản Phẩm</th>
                            <th>Giá Bán</th>
                            <th>Số Lượng</th>
                            <th>Giá Hiện Tại</th>
                            <th>Voucher</th>
                            <th>% Voucher</th>
                            <th>Tổng Tiền Sản Phẩm</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="cthd in invoicedetail">
                            <td>{{$index + 1}}</td>
                            <td>{{ cthd.productDetail.product.productName }} [{{ cthd.productDetail.color.colorName
                                }} - {{ cthd.productDetail.size.sizeNumber }}]</td>
                            <td>{{ cthd.productDetail.price | currency:'VND' }}</td>
                            <td>{{ cthd.quantity }}</td>
                            <td>{{ cthd.currentPrice | currency:'VND'}}</td>
                            <td>{{ cthd.invoice.voucher ? cthd.invoice.voucher.voucherCode : 'Không áp dụng' }}</td>
                            <td>{{ cthd.invoice.voucher ? cthd.invoice.voucher.discountPercentage + '(%)' : 'Không
                                áp dụng' }}</td>
                            <td>
                                {{ cthd.productDetail.price * cthd.quantity * (cthd.invoice.voucher ? (1 -
                                cthd.invoice.voucher.discountPercentage / 100) : 1) | currency:'VND' }}
                            </td>

                        </tr>
                    </tbody>
                </table>
            </div>



        </div>
    </div>
    </div>

    <script src="../assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/js/sidebarmenu.js"></script>
    <script src="../assets/js/app.min.js"></script>
    <script src="../assets/libs/apexcharts/dist/apexcharts.min.js"></script>
    <script src="../assets/libs/simplebar/dist/simplebar.js"></script>
    <script src="../assets/js/dashboard.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.8/dist/iconify-icon.min.js"></script>


</body>

</html>